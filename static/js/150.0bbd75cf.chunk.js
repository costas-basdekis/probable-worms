!function(){"use strict";var e={9150:function(e,t,n){var a=n(5671),i=n(3144),r=n(4165),u=n(7762),s=n(9062),o=n(3324),c=n(7675),l="W",h=[1,2,3,4,5,l],v=new Map([[1,1],[2,2],[3,3],[4,4],[5,5],[l,5]]),f=function(){function e(t){(0,a.Z)(this,e),this.counts=void 0,this.key=void 0,this.total=void 0,this.counts=new Map(t),this.key=JSON.stringify(Array.from(this.counts.entries()).sort()),this.total=Array.from(this.counts.entries()).reduce((function(e,t){var n=(0,o.Z)(t,2),a=n[0],i=n[1];return e+v.get(a)*i}),0)}return(0,i.Z)(e,[{key:"adding",value:function(t,n){return new e([].concat((0,s.Z)(Array.from(this.counts.entries())),[[t,n]]))}},{key:"get",value:function(e){return this.counts.get(e)}},{key:"has",value:function(e){return this.counts.has(e)}},{key:"keys",value:function(){return this.counts.keys()}},{key:"entries",value:function(){return this.counts.entries()}},{key:"count",get:function(){return this.counts.size}},{key:"diceCount",get:function(){return Array.from(this.counts.values()).reduce((function(e,t){return e+t}),0)}},{key:"dice",get:function(){return Array.from(this.counts.entries()).map((function(e){var t=(0,o.Z)(e,2),n=t[0],a=t[1];return c.ZP.range(a).map((function(){return n}))})).flat().sort((function(e,t){return v.get(e)-v.get(t)}))}},{key:"replacing",value:function(t,n){var a=new Map(this.counts.entries());return n?a.set(t,n):a.has(t)&&a.delete(t),new e(a.entries())}}],[{key:"fromDice",value:function(t){return new e(Object.values(c.ZP.groupBy(t)).map((function(e){return[e[0],e.length]})))}},{key:"getNextRolls",value:function(t){var n,a=new Map,i=(0,u.Z)(e.iterateDiceRolls(t));try{for(i.s();!(n=i.n()).done;){var r=n.value;a.has(r.key)||a.set(r.key,{diceRoll:r,count:0}),a.get(r.key).count+=1}}catch(s){i.e(s)}finally{i.f()}return Array.from(a.values())}},{key:"iterateDiceRolls",value:(0,r.Z)().mark((function t(n){var a,i,o,l,v,f,d;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=function(e,t){var n,i,o,c,l,h;return(0,r.Z)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:n=(0,u.Z)(e),a.prev=1,n.s();case 3:if((i=n.n()).done){a.next=24;break}o=i.value,c=(0,u.Z)(t),a.prev=6,c.s();case 8:if((l=c.n()).done){a.next=14;break}return h=l.value,a.next=12,[].concat((0,s.Z)(o),[h]);case 12:a.next=8;break;case 14:a.next=19;break;case 16:a.prev=16,a.t0=a.catch(6),c.e(a.t0);case 19:return a.prev=19,c.f(),a.finish(19);case 22:a.next=3;break;case 24:a.next=29;break;case 26:a.prev=26,a.t1=a.catch(1),n.e(a.t1);case 29:return a.prev=29,n.f(),a.finish(29);case 32:case"end":return a.stop()}}),a,null,[[1,26,29,32],[6,16,19,22]])},a=(0,r.Z)().mark(i),n){t.next=4;break}return t.abrupt("return");case 4:for(l in o=[[]],c.ZP.range(n))o=i(o,h);v=(0,u.Z)(o),t.prev=7,v.s();case 9:if((f=v.n()).done){t.next=15;break}return d=f.value,t.next=13,e.fromDice(d);case 13:t.next=9;break;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(7),v.e(t.t0);case 20:return t.prev=20,v.f(),t.finish(20);case 23:case"end":return t.stop()}}),t,null,[[7,17,20,23]])}))}]),e}(),d=function(){function e(t,n){(0,a.Z)(this,e),this.diceCounts=void 0,this.hasWorms=void 0,this.diceCounts=t,this.hasWorms=n}return(0,i.Z)(e,[{key:"total",get:function(){return this.diceCounts.total}},{key:"diceCount",get:function(){return this.diceCounts.diceCount}},{key:"dice",get:function(){return this.diceCounts.dice}},{key:"key",get:function(){return this.diceCounts.key}},{key:"uniqueDice",value:function(){return Array.from(this.diceCounts.keys()).sort()}},{key:"canAdd",value:function(e){return!this.diceCounts.has(e)}},{key:"add",value:function(t,n){if(!this.canAdd(t))throw new Error("Cannot add existing dice to chest");return new e(this.diceCounts.adding(t,n),this.hasWorms||t===l)}},{key:"get",value:function(e){return this.diceCounts.get(e)||0}},{key:"replacing",value:function(t,n){return e.fromDiceRoll(this.diceCounts.replacing(t,n))}}],[{key:"initial",value:function(){return new e(new f,!1)}},{key:"fromDiceRoll",value:function(t){return new e(new f(t.entries()),t.has(l))}},{key:"fromDice",value:function(e){return this.fromDiceRoll(f.fromDice(e))}}]),e}(),y=function(){function e(t){(0,a.Z)(this,e),this.counts=void 0,this.counts=new Map(t)}return(0,i.Z)(e,[{key:"get",value:function(e){return this.counts.get(e)}},{key:"set",value:function(e,t){return this.counts.set(e,t),this}},{key:"keys",value:function(){return this.counts.keys()}},{key:"entries",value:function(){return this.counts.entries()}},{key:"mergeWith",value:function(e){var t,n=(0,u.Z)(e.entries());try{for(n.s();!(t=n.n()).done;){var a=(0,o.Z)(t.value,2),i=a[0],r=a[1];this.set(i,(this.get(i)||0)+r)}}catch(s){n.e(s)}finally{n.f()}return this}},{key:"add",value:function(e,t){this.set(e,(this.get(e)||0)+t)}},{key:"total",get:function(){return Array.from(this.counts.values()).reduce((function(e,t){return e+t}),0)}},{key:"toFixed",value:function(){return new e(Array.from(this.entries()).map((function(e){var t,n=(0,o.Z)(e,2),a=n[0],i=n[1];if(isNaN(parseFloat(i.toFixed(6))))throw new Error("Value was not a number, it was a ".concat((null===i||void 0===i||null===(t=i.constructor)||void 0===t?void 0:t.name)||i,": ").concat(i));return[a,parseFloat(i.toFixed(6))]})))}},{key:"serialise",value:function(){return Array.from(this.entries())}},{key:"serialiseCompressed",value:function(){return this.serialise().sort((function(e,t){return(0,o.Z)(e,1)[0]-(0,o.Z)(t,1)[0]})).reduce((function(e,t){var n=(0,o.Z)(t,2),a=n[0],i=n[1],r=a,u=a;if(!e.length)return[[r,u,i]];var c=(0,o.Z)(e[e.length-1],3),l=c[0],h=c[1],v=c[2];return h!==u-1||v!==i?[].concat((0,s.Z)(e),[[r,u,i]]):[].concat((0,s.Z)(e.slice(0,e.length-1)),[[l,u,v]])}),[])}}],[{key:"deserialise",value:function(t){return new e(t)}},{key:"deserialiseCompressed",value:function(t){return new e(t.map((function(e){var t=(0,o.Z)(e,3),n=t[0],a=t[1],i=t[2];return c.ZP.range(n,a+1).map((function(e){return[e,i]}))})).flat())}}]),e}(),m=function(){function e(t,n,i){(0,a.Z)(this,e),this.minimumResultOccurrences=void 0,this.exactResultOccurrences=void 0,this.expectedValue=void 0,this.minimumResultOccurrences=t,this.exactResultOccurrences=n,this.expectedValue=i}return(0,i.Z)(e,[{key:"toFixed",value:function(){return new e(this.minimumResultOccurrences.toFixed(),this.exactResultOccurrences.toFixed(),parseFloat(this.expectedValue.toFixed(6)))}},{key:"serialise",value:function(){return{minimumResultOccurrencesEntries:this.minimumResultOccurrences.serialise(),exactResultOccurrencesEntries:this.exactResultOccurrences.serialise(),expectedValue:this.expectedValue}}},{key:"serialiseCompressed",value:function(){return{minimumResultOccurrencesEntries:this.minimumResultOccurrences.serialiseCompressed(),exactResultOccurrencesEntries:this.exactResultOccurrences.serialise(),expectedValue:this.expectedValue}}}],[{key:"combineOptions",value:function(e){var t,n=this.empty(),a=0,i=(0,u.Z)(e);try{for(i.s();!(t=i.n()).done;){var r,s=t.value,c=(0,u.Z)(s.minimumResultOccurrences.entries());try{for(c.s();!(r=c.n()).done;){var l=(0,o.Z)(r.value,2),h=l[0],v=l[1];n.minimumResultOccurrences.set(h,Math.max(n.minimumResultOccurrences.get(h)||0,v))}}catch(k){c.e(k)}finally{c.f()}var f,d=(0,u.Z)(s.exactResultOccurrences.entries());try{for(d.s();!(f=d.n()).done;){var y=(0,o.Z)(f.value,2),m=y[0],p=y[1];n.exactResultOccurrences.set(m,Math.max(n.exactResultOccurrences.get(m)||0,p))}}catch(k){d.e(k)}finally{d.f()}a=Math.max(a,s.expectedValue)}}catch(k){i.e(k)}finally{i.f()}return n.expectedValue=a,n}},{key:"combineProbabilities",value:function(e){var t,n=this.empty(),a=0,i=(0,u.Z)(e);try{for(i.s();!(t=i.n()).done;){var r,s=t.value,c=s.evaluation,l=s.ratio,h=(0,u.Z)(c.minimumResultOccurrences.entries());try{for(h.s();!(r=h.n()).done;){var v=(0,o.Z)(r.value,2),f=v[0],d=v[1];n.minimumResultOccurrences.set(f,(n.minimumResultOccurrences.get(f)||0)+d*l)}}catch(C){h.e(C)}finally{h.f()}var y,m=(0,u.Z)(c.exactResultOccurrences.entries());try{for(m.s();!(y=m.n()).done;){var p=(0,o.Z)(y.value,2),k=p[0],g=p[1];n.exactResultOccurrences.set(k,(n.exactResultOccurrences.get(k)||0)+g*l)}}catch(C){m.e(C)}finally{m.f()}a+=c.expectedValue*l}}catch(C){i.e(C)}finally{i.f()}return n.expectedValue=a,n}},{key:"fromTotal",value:function(e){var t,n=this.empty(),a=(0,u.Z)(c.ZP.range(1,e+1));try{for(a.s();!(t=a.n()).done;){var i=t.value;n.minimumResultOccurrences.set(i,1)}}catch(r){a.e(r)}finally{a.f()}return n.exactResultOccurrences.set(e,1),n.expectedValue=e,n}},{key:"empty",value:function(){return new e(new y,new y,0)}},{key:"deserialise",value:function(t){var n;return new e(y.deserialise(t.minimumResultOccurrencesEntries),y.deserialise(t.exactResultOccurrencesEntries),null!==(n=t.expectedValue)&&void 0!==n?n:0)}},{key:"deserialiseCompressed",value:function(t){var n;return new e(y.deserialiseCompressed(t.minimumResultOccurrencesEntries),y.deserialise(t.exactResultOccurrencesEntries),null!==(n=t.expectedValue)&&void 0!==n?n:0)}}]),e}(),p=function(){function e(){(0,a.Z)(this,e),this.cache=new Map,this.hitCount=0,this.missCount=0}return(0,i.Z)(e,[{key:"get",value:function(e){return this.cache.has(e)?this.hitCount++:this.missCount++,this.cache.get(e)}},{key:"set",value:function(e,t){this.cache.set(e,t)}},{key:"getStats",value:function(){return{hitCount:this.hitCount,missCount:this.missCount,entryCount:this.cache.size}}},{key:"serialise",value:function(){return Array.from(this.cache.entries()).map((function(e){var t=(0,o.Z)(e,2),n=t[0],a=t[1].serialise();return[n,a.minimumResultOccurrencesEntries,a.exactResultOccurrencesEntries,a.expectedValue]}))}},{key:"serialiseCompressed",value:function(){return Array.from(this.cache.entries()).map((function(e){var t=(0,o.Z)(e,2),n=t[0],a=t[1].serialiseCompressed();return[n,a.minimumResultOccurrencesEntries,a.exactResultOccurrencesEntries,a.expectedValue]}))}}],[{key:"deserialise",value:function(t){var n,a=new e,i=(0,u.Z)(t);try{for(i.s();!(n=i.n()).done;){var r=(0,o.Z)(n.value,4),s=r[0],c=r[1],l=r[2],h=r[3];a.set(s,m.deserialise({minimumResultOccurrencesEntries:c,exactResultOccurrencesEntries:l,expectedValue:null!==h&&void 0!==h?h:0}))}}catch(v){i.e(v)}finally{i.f()}return a}},{key:"deserialiseCompressed",value:function(t){var n,a=new e,i=(0,u.Z)(t);try{for(i.s();!(n=i.n()).done;){var r=(0,o.Z)(n.value,4),s=r[0],c=r[1],l=r[2],h=r[3];a.set(s,m.deserialiseCompressed({minimumResultOccurrencesEntries:c,exactResultOccurrencesEntries:l,expectedValue:null!==h&&void 0!==h?h:0}))}}catch(v){i.e(v)}finally{i.f()}return a}}]),e}(),k=function(){function e(t,n){(0,a.Z)(this,e),this.chest=void 0,this.remainingDiceCount=void 0,this.chest=t,this.remainingDiceCount=n}return(0,i.Z)(e,[{key:"total",get:function(){return this.chest.hasWorms?this.chest.total:0}},{key:"totalDiceCount",get:function(){return this.chest.diceCount+this.remainingDiceCount}},{key:"getNextRolledStates",value:function(){var e=this;return f.getNextRolls(this.remainingDiceCount).map((function(t){var n=t.diceRoll,a=t.count;return{rolledState:e.withRoll(n),count:a}}))}},{key:"withRoll",value:function(e){return new g(this,e)}},{key:"canAdd",value:function(e){return this.chest.canAdd(e)}},{key:"add",value:function(t,n){return new e(this.chest.add(t,n),this.remainingDiceCount-n)}},{key:"finished",value:function(){return new e(this.chest,0)}},{key:"serialise",value:function(){return{chestDice:this.chest.dice,remainingDiceCount:this.remainingDiceCount}}}],[{key:"initial",value:function(){return new e(d.initial(),8)}},{key:"empty",value:function(){return new e(d.initial(),0)}},{key:"fromDice",value:function(t,n){return new e(d.fromDice(t),n)}},{key:"deserialise",value:function(t){return e.fromDice(t.chestDice,t.remainingDiceCount)}}]),e}(),g=function(){function e(t,n){(0,a.Z)(this,e),this.unrolledState=void 0,this.diceRoll=void 0,this.unrolledState=t,this.diceRoll=n}return(0,i.Z)(e,[{key:"total",get:function(){return this.unrolledState.total}},{key:"getNextUnrolledStates",value:function(){var e=this,t=Array.from(this.diceRoll.entries()).filter((function(t){var n=(0,o.Z)(t,1)[0];return e.unrolledState.canAdd(n)})).map((function(t){var n=(0,o.Z)(t,2),a=n[0],i=n[1];return e.unrolledState.add(a,i)}));return t.length?t:[this.unrolledState.finished()]}}],[{key:"fromDice",value:function(t,n){return new e(k.fromDice(t,n.length),f.fromDice(n))}}]),e}(),C=n(1413),x=function(){function e(t,n,i){(0,a.Z)(this,e),this.unrolledState=void 0,this.nextRolledStates=void 0,this.evaluation=null,this.isRoot=void 0,this.unrolledState=t,this.nextRolledStates=n,this.isRoot=i}return(0,i.Z)(e,[{key:"finished",get:function(){return null!==this.evaluation}},{key:"processAll",value:function(){for(;this.processOne(););return this}},{key:"processOne",value:function(e){return!this.finished&&(!!this.nestedProcessOne(e)||(this.evaluation||(this.evaluation=this.compileEvaluation(),this.isRoot&&this.setOwnEvaluationCache(e)),!1))}},{key:"nestedProcessOne",value:function(e){var t=(null!==e&&void 0!==e?e:{}).removeEvaluated,n=void 0!==t&&t;if(this.finished)return!1;if(!this.nextRolledStates){if(null!==e&&void 0!==e&&e.evaluationCache){var a=e.evaluationCache.get(this.getCacheKey());if(a)return this.evaluation=a,!1}this.nextRolledStates=this.unrolledState.getNextRolledStates().map((function(e){return(0,C.Z)((0,C.Z)({},e),{},{evaluator:null,evaluation:null})}))}var i,r=(0,u.Z)(this.nextRolledStates);try{for(r.s();!(i=r.n()).done;){var s=i.value;if(!s.evaluation&&(s.evaluator||(s.evaluator=S.fromRolledState(s.rolledState),!this.useEvaluationCache(s,e))))return s.evaluator.processOne(e),s.evaluator.evaluation&&(s.evaluation=s.evaluator.evaluation,this.setEvaluationCache(s,e),n&&(s.evaluator=null)),!0}}catch(o){r.e(o)}finally{r.f()}return!1}},{key:"useEvaluationCache",value:function(e,t){if(!e.evaluator)return!1;var n=null!==t&&void 0!==t?t:{},a=n.removeEvaluated,i=void 0!==a&&a,r=n.evaluationCache,u=null===r||void 0===r?void 0:r.get(e.evaluator.getCacheKey());return!!u&&(e.evaluation=u,i&&(e.evaluator=null),!0)}},{key:"setEvaluationCache",value:function(e,t){if(e.evaluator&&e.evaluation){var n=(null!==t&&void 0!==t?t:{}).evaluationCache;n&&n.set(e.evaluator.getCacheKey(),e.evaluation)}}},{key:"setOwnEvaluationCache",value:function(e){if(this.evaluation){var t=(null!==e&&void 0!==e?e:{}).evaluationCache;t&&t.set(this.getCacheKey(),this.evaluation)}}},{key:"getCacheKey",value:function(){return["S","t".concat(this.unrolledState.chest.total),"c".concat(this.unrolledState.chest.uniqueDice().join(",")),"r".concat(this.unrolledState.remainingDiceCount)].join("").replaceAll(/[[\]]/g,"")}},{key:"compileEvaluation",value:function(){if(!this.nextRolledStates||this.nextRolledStates.some((function(e){return!e.evaluation})))throw new Error("Some part of the evaluation tree is not completed");return this.compilePartialEvaluation({useCached:!1})}},{key:"getCompletionProgress",value:function(){return this.finished?1:this.nextRolledStates?this.nextRolledStates.length?this.nextRolledStates.reduce((function(e,t){var n,a;return e+(t.evaluation?1:null!==(n=null===(a=t.evaluator)||void 0===a?void 0:a.getCompletionProgress())&&void 0!==n?n:0)}),0)/this.nextRolledStates.length:1:0}},{key:"compilePartialEvaluation",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).useCached,t=void 0===e||e;if(this.evaluation&&t)return this.evaluation;if(!this.nextRolledStates)return m.empty();if(!this.nextRolledStates.length)return m.fromTotal(this.unrolledState.total);var n=this.nextRolledStates.reduce((function(e,t){return e+t.count}),0),a=m.combineProbabilities(this.nextRolledStates.filter((function(e){var t=e.evaluator,n=e.evaluation;return t||n})).map((function(e){var t=e.evaluator,a=e.evaluation,i=e.count;return{evaluation:null!==a&&void 0!==a?a:t.compilePartialEvaluation(),ratio:i/n}})));return a.exactResultOccurrences.set(this.unrolledState.total,1),a}}],[{key:"fromUnrolledState",value:function(t,n){var a=t.getNextRolledStates();return new e(t,a.map((function(e){return(0,C.Z)((0,C.Z)({},e),{},{evaluator:null,evaluation:null})})),n)}},{key:"fromUnrolledStateLazy",value:function(t,n){return new e(t,null,n)}}]),e}(),S=function(){function e(t,n){(0,a.Z)(this,e),this.rolledState=void 0,this.nextUnrolledStates=void 0,this.evaluation=null,this.rolledState=t,this.nextUnrolledStates=n}return(0,i.Z)(e,[{key:"finished",get:function(){return null!==this.evaluation}},{key:"processAll",value:function(){for(;this.processOne(););return this}},{key:"processOne",value:function(e){return!this.finished&&(!!this.nestedProcessOne(e)||(this.evaluation=this.compileEvaluation(),!1))}},{key:"nestedProcessOne",value:function(e){var t=(null!==e&&void 0!==e?e:{}).removeEvaluated,n=void 0!==t&&t;if(this.finished)return!1;var a,i=(0,u.Z)(this.nextUnrolledStates);try{for(i.s();!(a=i.n()).done;){var r=a.value;if(!r.evaluation&&(r.evaluator||(r.evaluator=x.fromUnrolledState(r.unrolledState,!1),!this.useEvaluationCache(r,e))))return r.evaluator.processOne(e),r.evaluator.evaluation&&(r.evaluation=r.evaluator.evaluation,this.setEvaluationCache(r,e),n&&(r.evaluator=null)),!0}}catch(s){i.e(s)}finally{i.f()}return!1}},{key:"useEvaluationCache",value:function(e,t){if(!e.evaluator)return!1;var n=null!==t&&void 0!==t?t:{},a=n.removeEvaluated,i=void 0!==a&&a,r=n.evaluationCache,u=null===r||void 0===r?void 0:r.get(e.evaluator.getCacheKey());return!!u&&(e.evaluation=u,i&&(e.evaluator=null),!0)}},{key:"setEvaluationCache",value:function(e,t){if(e.evaluator&&e.evaluation){var n=(null!==t&&void 0!==t?t:{}).evaluationCache;n&&n.set(e.evaluator.getCacheKey(),e.evaluation)}}},{key:"getCacheKey",value:function(){return["R","t".concat(this.rolledState.unrolledState.chest.total),"c".concat(this.rolledState.unrolledState.chest.uniqueDice().join(",")),"d".concat(this.rolledState.diceRoll.key)].join("").replaceAll(/[[\]]/g,"")}},{key:"compileEvaluation",value:function(){if(this.nextUnrolledStates.some((function(e){return!e.evaluation})))throw new Error("Some part of the evaluation tree is not completed");return this.compilePartialEvaluation({useCached:!1})}},{key:"getCompletionProgress",value:function(){return this.finished?1:this.nextUnrolledStates.reduce((function(e,t){var n,a;return e+(t.evaluation?1:null!==(n=null===(a=t.evaluator)||void 0===a?void 0:a.getCompletionProgress())&&void 0!==n?n:0)}),0)/this.nextUnrolledStates.length}},{key:"compilePartialEvaluation",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).useCached,t=void 0===e||e;return this.evaluation&&t?this.evaluation:m.combineOptions(this.nextUnrolledStates.filter((function(e){var t=e.evaluator,n=e.evaluation;return t||n})).map((function(e){var t=e.evaluator,n=e.evaluation;return null!==n&&void 0!==n?n:t.compilePartialEvaluation()})))}}],[{key:"fromRolledState",value:function(t){var n=t.getNextUnrolledStates();return new e(t,n.map((function(e){return{unrolledState:e,evaluator:null,evaluation:null}})))}}]),e}(),R=n(5861),w=function(){function e(){(0,a.Z)(this,e),this.evaluationCacheUrlMap=new Map([[5,"evaluation-cache-5-dice.json"],[6,"evaluation-cache-6-dice.json"],[7,"evaluation-cache-7-dice.json"],[8,"evaluation-cache-8-dice.json"]]),this.evaluationCacheMap=new Map}return(0,i.Z)(e,[{key:"get",value:function(){var e=(0,R.Z)((0,r.Z)().mark((function e(t){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.evaluationCacheMap.has(t)){e.next=16;break}return e.t0=this.evaluationCacheMap,e.t1=t,e.next=5,this.fetchEvaluationCache(t);case 5:if(e.t3=n=e.sent,e.t2=null!==e.t3,!e.t2){e.next=9;break}e.t2=void 0!==n;case 9:if(!e.t2){e.next=13;break}e.t4=n,e.next=14;break;case 13:e.t4=new p;case 14:e.t5=e.t4,e.t0.set.call(e.t0,e.t1,e.t5);case 16:return e.abrupt("return",this.evaluationCacheMap.get(t));case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getSync",value:function(e,t){var n=this;return this.evaluationCacheMap.has(e)||((0,R.Z)((0,r.Z)().mark((function a(){return(0,r.Z)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.t0=t,a.next=3,n.get(e);case 3:a.t1=a.sent,(0,a.t0)(a.t1);case 5:case"end":return a.stop()}}),a)})))(),this.evaluationCacheMap.set(e,new p)),this.evaluationCacheMap.get(e)}},{key:"fetchEvaluationCache",value:function(){var e=(0,R.Z)((0,r.Z)().mark((function e(t){var n,a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.evaluationCacheUrlMap.get(t)){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=5,fetch("".concat("/probable-worms","/").concat(n));case 5:return a=e.sent,e.prev=6,e.t0=p,e.t1=JSON,e.next=11,a.text();case 11:return e.t2=e.sent,e.t3=e.t1.parse.call(e.t1,e.t2),e.abrupt("return",e.t0.deserialiseCompressed.call(e.t0,e.t3));case 16:return e.prev=16,e.t4=e.catch(6),console.error("File was not a valid cache file"),e.abrupt("return",null);case 20:case"end":return e.stop()}}),e,this,[[6,16]])})));return function(t){return e.apply(this,arguments)}}()},{key:"clear",value:function(e){return this.evaluationCacheMap.set(e,new p),this.evaluationCacheMap.get(e)}}]),e}(),Z=function(){function e(t){var n=this;(0,a.Z)(this,e),this.instancesById=new Map,this.worker=void 0,this.evaluationCacheCache=new w,this.onMessage=function(e){var t=e.data;switch(t.type){case"set-unrolled-state":n.onSetUnrolledState(t.id,k.deserialise(t.state));break;case"step":n.onStep(t.id);break;case"start":n.onStart(t.id);break;case"stop":n.onStop(t.id);break;case"remove":n.onRemove(t.id);break;case"download-evaluation-cache":n.onDownloadEvaluationCache(t.id);break;case"load-evaluation-cache":n.onLoadEvaluationCache(t.id,t.jsonSerialised);break;case"clear-evaluation-cache":n.onClearEvaluationCache(t.id)}},this.worker=t,this.worker.onmessage=this.onMessage}return(0,i.Z)(e,[{key:"postMessage",value:function(e){this.worker.postMessage(e)}},{key:"postResult",value:function(e){if(this.instancesById.has(e)){var t=this.instancesById.get(e),n=t.unrolledStateEvaluator,a=t.searching,i=t.evaluationCache,r=n.getCompletionProgress();this.postMessage({type:"result",id:e,progress:r,searching:a,searchFinished:1===r,evaluation:n.compilePartialEvaluation().serialise(),cacheStats:i.getStats()})}}},{key:"onSetUnrolledState",value:function(e,t){var n=this;this.onStop(e),this.instancesById.set(e,{id:e,unrolledStateEvaluator:x.fromUnrolledStateLazy(t,!0),searching:!1,evaluationCache:this.evaluationCacheCache.getSync(t.totalDiceCount,(function(t){var a=n.instancesById.get(e);a&&(a.evaluationCache=t,n.postResult(e))}))})}},{key:"onStep",value:function(e){if(this.instancesById.has(e)){var t=this.instancesById.get(e),n=t.unrolledStateEvaluator,a=t.evaluationCache;n.processOne({removeEvaluated:!0,evaluationCache:a}),this.postResult(e)}}},{key:"onStart",value:function(e){this.onStop(e);var t=this.makeSearch(e);t&&self.setTimeout(t,0)}},{key:"onDownloadEvaluationCache",value:function(e){if(this.instancesById.has(e)){var t=this.instancesById.get(e).evaluationCache,n=(new TextEncoder).encode(JSON.stringify(t.serialiseCompressed())),a=new Blob([n],{type:"application/json;charset=utf-8"}),i=URL.createObjectURL(a);self.postMessage({type:"evaluation-cache-link",id:e,link:i})}}},{key:"onLoadEvaluationCache",value:function(e,t){if(this.instancesById.has(e)){var n=this.instancesById.get(e);try{n.evaluationCache=p.deserialiseCompressed(JSON.parse(t))}catch(a){return void console.error("File was not a valid cache file")}this.postResult(e)}}},{key:"onClearEvaluationCache",value:function(e){this.instancesById.has(e)&&(this.instancesById.get(e).evaluationCache=new p,this.postResult(e))}},{key:"makeSearch",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;if(!this.instancesById.has(e))return null;var a=this.instancesById.get(e);a.searching=!0;return function i(){for(var r=new Date;a.searching&&!a.unrolledStateEvaluator.finished;){if(a.unrolledStateEvaluator.processOne({removeEvaluated:!0,evaluationCache:a.evaluationCache}),(new Date).valueOf()-r.valueOf()>=n){self.setTimeout(i,0);break}}t.postResult(e)}}},{key:"onStop",value:function(e){this.instancesById.has(e)&&(this.instancesById.get(e).searching=!1,this.postResult(e))}},{key:"onRemove",value:function(e){this.instancesById.has(e)&&(this.instancesById.get(e).searching=!1,this.postResult(e),this.instancesById.delete(e))}}],[{key:"default",value:function(){return new e(self)}}]),e}();Z.default()}},t={};function n(a){var i=t[a];if(void 0!==i)return i.exports;var r=t[a]={exports:{}};return e[a](r,r.exports,n),r.exports}n.m=e,n.x=function(){var e=n.O(void 0,[871],(function(){return n(9150)}));return e=n.O(e)},function(){var e=[];n.O=function(t,a,i,r){if(!a){var u=1/0;for(l=0;l<e.length;l++){a=e[l][0],i=e[l][1],r=e[l][2];for(var s=!0,o=0;o<a.length;o++)(!1&r||u>=r)&&Object.keys(n.O).every((function(e){return n.O[e](a[o])}))?a.splice(o--,1):(s=!1,r<u&&(u=r));if(s){e.splice(l--,1);var c=i();void 0!==c&&(t=c)}}return t}r=r||0;for(var l=e.length;l>0&&e[l-1][2]>r;l--)e[l]=e[l-1];e[l]=[a,i,r]}}(),n.d=function(e,t){for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.f={},n.e=function(e){return Promise.all(Object.keys(n.f).reduce((function(t,a){return n.f[a](e,t),t}),[]))},n.u=function(e){return"static/js/"+e+".6b4d62fe.chunk.js"},n.miniCssF=function(e){},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/probable-worms/",function(){var e={150:1};n.f.i=function(t,a){e[t]||importScripts(n.p+n.u(t))};var t=self.webpackChunkprobable_worms=self.webpackChunkprobable_worms||[],a=t.push.bind(t);t.push=function(t){var i=t[0],r=t[1],u=t[2];for(var s in r)n.o(r,s)&&(n.m[s]=r[s]);for(u&&u(n);i.length;)e[i.pop()]=1;a(t)}}(),function(){var e=n.x;n.x=function(){return n.e(871).then(e)}}();n.x()}();
//# sourceMappingURL=150.0bbd75cf.chunk.js.map